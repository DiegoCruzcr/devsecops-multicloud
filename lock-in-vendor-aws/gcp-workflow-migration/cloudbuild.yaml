steps:
  - name: "gcr.io/cloud-builders/docker"
    args: [ "build", "-t", "REGION-docker.pkg.dev/PROJECT_ID/app-repo/app:latest", "." ]
  - name: "gcr.io/cloud-builders/docker"
    args: [ "push", "REGION-docker.pkg.dev/PROJECT_ID/app-repo/app:latest" ]
  - name: "gcr.io/google.com/cloudsdktool/cloud-sdk"
    entrypoint: gcloud
    args:
      - run
      - deploy
      - app-service
      - --image=REGION-docker.pkg.dev/PROJECT_ID/app-repo/app:latest
      - --region=REGION
      - --platform=managed
      - --allow-unauthenticated
substitutions:
  _REGION: us-central1
  _PROJECT_ID: devsecops-multicloud
images:
  - "REGION-docker.pkg.dev/PROJECT_ID/app-repo/app:latest"
